@page "/inventory"
@using StoreManagement.Client.Models
@using StoreManagement.Client.Services
@inject IStoreService StoreService

<h3>üì¶ Qu·∫£n L√Ω Kho H√†ng & T·ªìn Kho</h3>

<div class="row mb-3">
    <div class="col-md-3">
        <div class="card text-white bg-danger mb-3">
            <div class="card-body">
                <h5 class="card-title">S·∫Øp h·∫øt h√†ng</h5>
                <p class="card-text fs-4">@books?.Count(b => b.StockQuantity <= 5)</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success mb-3">
            <div class="card-body">
                <h5 class="card-title">T·ªïng s·∫£n ph·∫©m</h5>
                <p class="card-text fs-4">@books?.Count</p>
            </div>
        </div>
    </div>
</div>

@if (books == null)
{
    <p>Loading...</p>
}
else
{
    <table class="table table-bordered align-middle">
        <thead class="table-light">
            <tr>
                <th>S√°ch</th>
                <th>Gi√° B√°n</th>
                <th>Nh·∫≠p/Xu·∫•t/T·ªìn</th>
                <th>Tr·∫°ng th√°i</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var book in books)
            {
                // Logic c·∫£nh b√°o m√†u s·∫Øc
                var rowClass = book.StockQuantity == 0 ? "table-danger" : (book.StockQuantity <= 5 ? "table-warning" : "");
                
                <tr class="@rowClass">
                    <td>
                        <div class="d-flex align-items-center">
                            <img src="@book.Image" style="width: 40px; margin-right: 10px;" />
                            <div>
                                <strong>@book.Title</strong><br/>
                                <small>@book.Isbn</small>
                            </div>
                        </div>
                    </td>
                    <td>@book.RetailPrice.ToString("N0") ƒë</td>
                    <td>
                        <div>T·ªìn hi·ªán t·∫°i: <strong>@book.StockQuantity</strong></div>
                        <small class="text-muted">ƒê√£ b√°n: (Ch∆∞a c√≥ POS)</small>
                    </td>
                    <td>
                        @if (book.StockQuantity == 0)
                        {
                            <span class="badge bg-danger">H·∫æT H√ÄNG</span>
                        }
                        else if (book.StockQuantity <= 5)
                        {
                            <span class="badge bg-warning text-dark">S·∫ÆP H·∫æT (@book.StockQuantity)</span>
                        }
                        else
                        {
                            <span class="badge bg-success">S·∫µn s√†ng</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private List<Book> books;
    protected override async Task OnInitializedAsync()
    {
        books = await StoreService.GetBooksAsync();
    }
}