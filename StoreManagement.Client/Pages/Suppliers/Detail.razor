@page "/suppliers/{id}"
@using StoreManagement.Client.Models
@using StoreManagement.Client.Services
@inject IStoreService StoreService

@if (supplier == null)
{
    <p>ƒêang t·∫£i ho·∫∑c kh√¥ng t√¨m th·∫•y...</p>
}
else
{
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h4>üè¢ @supplier.SupplierName</h4>
        </div>
        <div class="card-body">
            <p><strong>Ng∆∞·ªùi li√™n h·ªá:</strong> @supplier.ContactPerson</p>
            <p><strong>SƒêT:</strong> @supplier.Phone</p>
            <p><strong>ƒê·ªãa ch·ªâ:</strong> @supplier.Address</p>
        </div>
    </div>

    <h4>üìú L·ªãch s·ª≠ nh·∫≠p h√†ng</h4>
    @if (supplier.InventoryReceipts == null || !supplier.InventoryReceipts.Any())
    {
        <div class="alert alert-info">Ch∆∞a c√≥ phi·∫øu nh·∫≠p n√†o t·ª´ nh√† cung c·∫•p n√†y.</div>
    }
    else
    {
        <table class="table table-bordered">
            <thead class="table-light">
                <tr>
                    <th>Ng√†y nh·∫≠p</th>
                    <th>Ng∆∞·ªùi nh·∫≠p</th>
                    <th>T·ªïng ti·ªÅn</th>
                    <th>Chi ti·∫øt</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var receipt in supplier.InventoryReceipts.OrderByDescending(x => x.ReceiptDate))
                {
                    <tr>
                        <td>@receipt.ReceiptDate.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>@receipt.ReceivingStaffId</td>
                        <td class="text-end fw-bold">@receipt.TotalCost.ToString("N0") ƒë</td>
                        <td>
                            <ul>
                                @foreach(var detail in receipt.ReceiptDetails)
                                {
                                    <li>@GetBookName(detail.BookId) (SL: @detail.QuantityReceived)</li>
                                }
                            </ul>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
}

@code {
    [Parameter] public string Id { get; set; }
    private Supplier? supplier;
    private List<Book> books = new();

    protected override async Task OnInitializedAsync()
    {
        books = await StoreService.GetBooksAsync(); // L·∫•y list s√°ch ƒë·ªÉ hi·ªÉn th·ªã t√™n
        supplier = await StoreService.GetSupplierWithHistoryAsync(Id);
    }

    private string GetBookName(string bookId) => books.FirstOrDefault(b => b.Id == bookId)?.Title ?? bookId;
}